<h1 style="text-align: center;">Controle de Projetos</h1>
<!-- <pre>{{this.projetos | json }}</pre> -->

<p-fieldset   (onBeforeToggle)="obterOsPorProjeto(projeto.id)" *ngFor="let projeto of projetos" [toggleable]="true" [collapsed]="true">
  
  <p-header>{{projeto.nome}}</p-header>
  <div>
    <p-tabView>
      <p-tabPanel [header]="item.header" *ngFor="let item of items; let i = index" [selected]="i == 0">
        {{item.content}}
      </p-tabPanel>
      
      <p-tabPanel header="Lider" leftIcon="pi pi-user">
        {{obterNomeLider(projeto.idLider)}}
      </p-tabPanel>
      <p-tabPanel header="Testador" leftIcon="pi pi-inbox">
        {{obterNomeTestador(projeto.id)}} 
      </p-tabPanel>
      <p-tabPanel header="Revisor" leftIcon="pi pi-user" rightIcon="pi pi-star">
        {{obterNomeRevisor(projeto.id)}}
      </p-tabPanel>
      <p-tabPanel header="Gerente" leftIcon="pi pi-user" rightIcon="pi pi-star">
        {{obterNomeGerente(projeto.id)}}
    </p-tabPanel>
  </p-tabView>

  </div>
  
  
  <p-table [value]="listaOsProjeto" [paginator]="true" [rows]="4" [response]="true" [columns]="colunas" dataKey="status">
    
    <ng-template let-columns pTemplate="header">
      <tr>
        <th style="width: 3em"></th>
          <th [class.action]="coluna.header == 'Ações'" *ngFor="let coluna of columns" pResizableColumn>
                    {{coluna.header}}
          </th>
        </tr>
    </ng-template>

    <ng-template pTemplate="body" let-ordemservico let-expanded="expanded" let-columns="columns">
      <tr>
        <!-- Quando clicar nessa seta, chamar uma função que carrega as sprints relacionadas com a os em questão -->
        <td>
          <a href="#" [pRowToggler]="ordemservico">
            <i [ngClass]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'" ></i>
          </a>
        </td>
        <td>{{ ordemservico.nome }}</td>
        <td>{{ obterSituacoes(ordemservico.idSituacao) }}</td>
        <td>{{ ordemservico.dataProximaEntrega}}</td>
        <td>{{ ordemservico.prazo }}</td>
        <td>{{ ordemservico.pontosFuncao}}</td>
        <td>{{ ordemservico.fabrica }}</td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage" let-columns>
      <tr>
        <td [attr.colspan]="columns.length">
          <div class="text-center">
            <h3>Nenhuma ordem de serviço cadastrada!</h3>
          </div>
        </td>
      </tr>
    </ng-template>
      
  <!-- SPRINT -->
  <ng-template pTemplate="rowexpansion" let-teste let-columns="columns">
    <tr>
      <td [attr.colspan]="columns.length + 1">
        <div class="p-grid -fluid" style="font-size:16px;padding:5px 5px 20px 5px;">
          <p-table paginator="true" [rows]="5" [columns]="colunaSprint" [value]="testeSprint" dataKey="status">
            <ng-template pTemplate="header" let-subcolumns>
              <tr>
                <th *ngFor="let sub of subcolumns">
                  {{sub.header}}
                </th>
              </tr>
            </ng-template>

            <ng-template pTemplate="body" let-testeSprint let-expanded="expanded">
              <tr>
               <td>{{ testeSprint.nome }}</td>
               <td>{{ testeSprint.inicio }}</td>
               <td>{{ testeSprint.termino }}</td>
               <td>{{ testeSprint.pf }}</td>
               <td>{{ testeSprint.impedimento}}</td>
               <td>{{ testeSprint.prazo }}</td>
               <td>{{ testeSprint.status }}</td>
              </tr>
            </ng-template>

            <ng-template pTemplate="emptymessage" let-subcolumns>
              <tr>
                <td [attr.colspan]="columns.length">
                  <div class="text-center">
                    <h3>Nenhuma OS cadastrada!</h3>
                  </div>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </td>
    </tr>
  </ng-template>

</p-table>

</p-fieldset>

